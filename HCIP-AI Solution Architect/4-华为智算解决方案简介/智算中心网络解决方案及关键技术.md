# AI训练对网络的需求 
## 人工智能基本工作流程
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=275&rect=77,455,479,628&color=red|HCIP-AI Solution Architect V1.0 培训教材, p.275]]
## 大模型的集合通信模式
#### 基本操作
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=276&rect=72,457,483,642&color=red|HCIP-AI Solution Architect V1.0 培训教材, p.276]]
#### 组合操作
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=277&rect=76,456,479,638&color=red|HCIP-AI Solution Architect V1.0 培训教材, p.277]]
## 模型训练的通信量估计
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=279&rect=75,482,482,613&color=yellow|HCIP-AI Solution Architect V1.0 培训教材, p.279]]
## 模型训练的网络特性要求
#### RDMA是刚需
RDMA（Remote Direct Memory Access）远程直接内存访问，这是一种通过网络在两个服务器的应用软件之间搬运缓冲区里的数据的方法。
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=280&rect=86,448,458,601&color=yellow|HCIP-AI Solution Architect V1.0 培训教材, p.280]]
#### 大带宽是基础
大模型训练为带宽敏感型，数据搬移时间主要取决于有效带宽 
网络交换的时间占比不高，交换时延对模型训练效率影响不大，静态时延不敏感
####  负载均衡是关键
大模型训练系统，网络最关键在于保证通信的有效带宽，负载均衡对有效带宽影响最大，为最关键问题。 
无阻塞网络，若负载不均衡，导致冲突流有效带宽下降（N流冲突，下降为1/N），冲突流的传输时间恶化。集合操作通信的完成时间由最慢的节点的完成时间决定

# 智算中心网络解决方案-超融合以太网络 
## 无损以太网络协议发展
在融合以太网中，使用RoCE技术使得以太网可以承载原属于IB网络的RDMA协议，实现服务器间的高速IO互访需求，同时使用FCoE（fiber channel over ethernet）实现通过以太网络承载存储传输协议iSCSI。
## RDMA承载网络
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=285&rect=109,478,446,623&color=yellow|HCIP-AI Solution Architect V1.0 培训教材, p.285]]
- 相同点：相同的RDMA传输层标准，在同一个标准组织定义，使用相同的编程接口， 共享相同的RDMA应用生态 
- 不同点：IB同子网包头信息短，有效载荷略高。RoCE具备以太和IP的优势：大规模网络、网络虚拟化、网络运维等
## 技术路线
#### IB 
IB 是一种高性能、低延迟的计算和存储网络技术, 传输方式上基于硅光半导体和光纤通信的高速互联， 支持快速和可靠的数据传输
#### RoCE
RoCE 是一种允许在以太网上执行 RDMA 的网络协议，具有高性能、低延迟、低 CPU 占用、低成本以及与现有数据中心以太网高度兼容的优点，被广泛应用于需要高速数据传输和低延迟的领域
```ad-note
title:RDMA实现路径
一共有四种实现路径:InfiniBand, RoCEv1, RoCEv2, iWARP。其中RoCEv1已经被弃用，iWARP不常用。目前业界常用的网络解决方案就是InfiniBnad(协议封闭、生态固化)和RoCEv2
```
## 典型智算中心总体方案：高速无损数据中心网络架构
![[HCIP-AI Solution Architect V1.0 培训教材.pdf#page=288&rect=70,454,447,639&color=yellow|HCIP-AI Solution Architect V1.0 培训教材, p.288]]

# 华为无损网络关键技术
## 流控技术：PFC（Priority-based Flow Control）
## 拥塞控制技术：ECN与DCQCN
## NoF技术：NVMe over Fabric
随着现代信息技术的不断发展，对存储的性能要求越来越高，特别是闪存的发展，存储介质的速度越来越高，传统SCSI协议难以适应闪存盘的快速发展，亟需一种新的协议，实现盘片与主机高性能通信，NVMe协议应运而生。随着NVMe协议在闪存盘的应用快速推广， 对于端到端NVMe协议的诉求越来越强烈。2017年定义了基于 RDMA传输层的NVMe over Fabric协议，并快速扩展到FC和TCP传输层，从而实现了端到端的全路径NVMe协议，进一步提升性能和降低时延
## NVMe over RoCE
NVMe over RoCE是NVMe over Fabric（基于RDMA）的一种，在性能、成本、网络管理、技术发展等方面有显著优化，正逐步成为NVMe over Fabric的最佳应用。
